var shellPerformance=window.performance,HighResolutionTimingSupported=!!shellPerformance&&"function"==typeof shellPerformance.mark;HighResolutionTimingSupported&&shellPerformance.mark("shell_chat_start"),(window.suiteux_shell_webpackJsonp_main=window.suiteux_shell_webpackJsonp_main||[]).push([["chat"],{410:function(t,e){var n,i,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var c,u=[],p=!1,l=-1;function h(){p&&c&&(p=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!p){var t=s(h);p=!0;for(var e=u.length;e;){for(c=u,u=[];++l<e;)c&&c[l].run();l=-1,e=u.length}c=null,p=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new f(t,e)),1!==u.length||p||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},700:function(t,e,n){var i=n(701);"string"==typeof i&&(i=[[t.i,i,""]]);n(36)(i,{});i.locals&&(t.exports=i.locals)},701:function(t,e,n){(e=t.exports=n(35)(!1)).push([t.i,"._3h4sI7nX01-RHWxPYubeSU{display:inline-block;font-size:19px;vertical-align:middle}",""]),e.locals={icon:"_3h4sI7nX01-RHWxPYubeSU"}},702:function(t,e,n){var i=n(703);"string"==typeof i&&(i=[[t.i,i,""]]);n(36)(i,{});i.locals&&(t.exports=i.locals)},703:function(t,e,n){(e=t.exports=n(35)(!1)).push([t.i,"._3621pkmF-lKp4k2Fzdaqy{position:absolute;z-index:1000000;background-color:#fff;width:320px;box-sizing:border-box;outline:none;overflow-y:auto;visibility:visible;pointer-events:auto;box-shadow:0 2px 4px 0 rgba(0,0,0,.22);overflow-y:hidden;min-width:320px;max-width:320px;top:50px;height:450px;outline:0;display:block;visibility:hidden;z-index:1000001;-webkit-transform-origin:top;-ms-transform-origin:top;transform-origin:top;-webkit-animation-duration:.18s;animation-duration:.18s;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-timing-function:ease;animation-timing-function:ease}._3sQksgj9I49rwkKr35v0Z0{-webkit-animation-name:slideInFrames;animation-name:slideInFrames;visibility:visible}@-webkit-keyframes slideInFrames{0%{opacity:0;-webkit-transform:scale(.95);-ms-transform:scale(.95);transform:scale(.95)}to{opacity:1;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}@keyframes slideInFrames{0%{opacity:0;-webkit-transform:scale(.95);-ms-transform:scale(.95);transform:scale(.95)}to{opacity:1;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}.BZqRf1M4uMYyXzdFfjHyN{box-shadow:0 2px 4px 0 rgba(0,0,0,.22);overflow-y:hidden}._8OxoRyxtoXn9ILQI2XSEE{height:450px;width:320px}",""]),e.locals={chatWindowWidth:"320",chatPopup:"_3621pkmF-lKp4k2Fzdaqy",popupSlideIn:"_3sQksgj9I49rwkKr35v0Z0",callout:"BZqRf1M4uMYyXzdFfjHyN",recentsWrapper:"_8OxoRyxtoXn9ILQI2XSEE"}},704:function(t,e,n){var i=n(705);"string"==typeof i&&(i=[[t.i,i,""]]);n(36)(i,{});i.locals&&(t.exports=i.locals)},705:function(t,e,n){(e=t.exports=n(35)(!1)).push([t.i,".bMv2Khh1xMvmSgdvstP6F{bottom:0;right:0;padding-right:20px;position:absolute;display:flex;z-index:1000001;align-items:flex-end;max-width:calc(100% - 320px);-webkit-box-align:end}.bMv2Khh1xMvmSgdvstP6F .conversation{display:initial}.bMv2Khh1xMvmSgdvstP6F iframe{margin-right:10px}",""]),e.locals={wrapperStyle:"bMv2Khh1xMvmSgdvstP6F"}},706:function(t,e,n){(function(t){// Copyright Joyent, Inc. and other Node contributors.
// distribute, sublicense, and/or sell copies of the Software, and to permit
// The above copyright notice and this permission notice shall be included
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),n={},i=0;i<e.length;i++)n[e[i]]=Object.getOwnPropertyDescriptor(t,e[i]);return n},r=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(s(arguments[n]));return e.join(" ")}n=1;for(var i=arguments,o=i.length,a=String(t).replace(r,(function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return t}})),c=i[n];n<o;c=i[++n])m(c)||!C(c)?a+=" "+c:a+=" "+s(c);return a},e.deprecate=function(n,i){if(void 0!==t&&!0===t.noDeprecation)return n;if(void 0===t)return function(){return e.deprecate(n,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation,r=!0}return n.apply(this,arguments)}};var o,a={};function s(t,n){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),f(n)?i.showHidden=n:n&&e._extend(i,n),g(i.showHidden)&&(i.showHidden=!1),g(i.depth)&&(i.depth=2),g(i.colors)&&(i.colors=!1),g(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=c),p(i,t,i.depth)}function c(t,e){var n=s.styles[e];return n?"["+s.colors[n][0]+"m"+t+"["+s.colors[n][1]+"m":t}function u(t,e){return t}function p(t,n,i){if(t.customInspect&&n&&I(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,t);return y(r)||(r=p(t,r,i)),r}var o=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(y(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(b(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,n);if(o)return o;var a=Object.keys(n),s=function(t){var e={};return t.forEach((function(t,n){e[t]=!0})),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),S(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(n);if(0===a.length){if(I(n)){var c=n.name?": "+n.name:"";return t.stylize("[Function"+c+"]","special")}if(v(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return t.stylize(Date.prototype.toString.call(n),"date");if(S(n))return l(n)}var u,C="",O=!1,E=["{","}"];(d(n)&&(O=!0,E=["[","]"]),I(n))&&(C=" [Function"+(n.name?": "+n.name:"")+"]");return v(n)&&(C=" "+RegExp.prototype.toString.call(n)),w(n)&&(C=" "+Date.prototype.toUTCString.call(n)),S(n)&&(C=" "+l(n)),0!==a.length||O&&0!=n.length?i<0?v(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=O?function(t,e,n,i,r){for(var o=[],a=0,s=e.length;a<s;++a)P(e,String(a))?o.push(h(t,e,n,i,String(a),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(h(t,e,n,i,r,!0))})),o}(t,n,i,s,a):a.map((function(e){return h(t,n,i,s,e,O)})),t.seen.pop(),function(t,e,n){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(u,C,E)):E[0]+C+E[1]}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,n,i,r,o){var a,s,c;if((c=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?s=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(s=t.stylize("[Setter]","special")),P(i,r)||(a="["+r+"]"),s||(t.seen.indexOf(c.value)<0?(s=m(n)?p(t,c.value,null):p(t,c.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+s.split("\n").map((function(t){return"   "+t})).join("\n")):s=t.stylize("[Circular]","special")),g(a)){if(o&&r.match(/^\d+$/))return s;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function d(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function b(t){return"number"==typeof t}function y(t){return"string"==typeof t}function g(t){return void 0===t}function v(t){return C(t)&&"[object RegExp]"===O(t)}function C(t){return"object"==typeof t&&null!==t}function w(t){return C(t)&&"[object Date]"===O(t)}function S(t){return C(t)&&("[object Error]"===O(t)||t instanceof Error)}function I(t){return"function"==typeof t}function O(t){return Object.prototype.toString.call(t)}e.debuglog=function(n){if(g(o)&&(o=Object({NODE_ENV:"production",__DEV__:!1,BUILD_BUILDNUMBER:"20210420.3"}).NODE_DEBUG||""),n=n.toUpperCase(),!a[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){t.pid;a[n]=function(){e.format.apply(e,arguments)}}else a[n]=function(){};return a[n]},e.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=f,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=b,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=v,e.isObject=C,e.isDate=w,e.isError=S,e.isFunction=I,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(707);function P(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){},e.inherits=n(708),e._extend=function(t,e){if(!e||!C(e))return t;for(var n=Object.keys(e),i=n.length;i--;)t[n[i]]=e[n[i]];return t};var E="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function j(t,e){if(!t){var n=new Error("Promise was rejected with a falsy value");n.reason=t,t=n}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(E&&t[E]){var e;if("function"!=typeof(e=t[E]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,n,i=new Promise((function(t,i){e=t,n=i})),r=[],o=0;o<arguments.length;o++)r.push(arguments[o]);r.push((function(t,i){t?n(t):e(i)}));try{t.apply(this,r)}catch(t){n(t)}return i}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),E&&Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=E,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],i=0;i<arguments.length;i++)n.push(arguments[i]);var r=n.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return r.apply(o,arguments)};e.apply(this,n).then((function(e){t.nextTick(a,null,e)}),(function(e){t.nextTick(j,e,a)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.defineProperties(n,i(e)),n}}).call(this,n(410))},707:function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},708:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},878:function(t,e,n){"use strict";n.r(e),n.d(e,"ChatHeaderButtonConnector",(function(){return J})),n.d(e,"ChatIconConnector",(function(){return $})),n.d(e,"initializeChatComponent",(function(){return q}));var i,r=n(2),o=n(27),a=n(14),s=n(3),c=n(34),u=n(0),p=n(1),l=n(15),h=n(16),d=n(41),f=n(700),m=n(13),b=n(7),y=n(9),g=function(t){var e=t instanceof MouseEvent;if(t instanceof KeyboardEvent)switch(t.which){case 40:e=t.altKey;break;case 13:case 32:e=!0}e&&function(t){t.preventDefault(),window.open(i),Object(p.f)().click("ChatButton","NavBar",null,null,"Default chat web page")}(t)};var v,C=function(t){function e(e){var n=t.call(this,e)||this;return n.onMouseChange=function(t){return n.setState({isHovered:t})},n.state={isHovered:!1},i=n.props.chatWebLink,n}return Object(u.__extends)(e,t),e.prototype.render=function(){if(!this.props.chatEnabled)return null;var t=this.props.isConsumerShell?"SkypeLogo":"OfficeChat",e=Object(h.a)();return r.createElement("button",{type:"button",id:l.a,className:Object(s.t)(m.button,e.headerButton),"aria-disabled":"false",title:b.a.Chat,"aria-label":b.a.Chat,role:"button",onMouseEnter:this.onMouseChange.bind(this,!0),onMouseLeave:this.onMouseChange.bind(this,!1)},r.createElement(s.e,{fontIconCss:"ms-Icon--"+t,fontSize:y.f.toString(),className:Object(s.t)(f.icon),isAriaHidden:!0}),r.createElement(s.n,{unseenItemCount:this.props.unreadBadgeValue,isParentHovered:this.state.isHovered,badgeStyles:Object(s.t)(m.headerButtonBadgePosition)}))},e.prototype.componentDidMount=function(){Object(s.p)([l.a],d.a.CLICK+" "+d.a.KEYDOWN,g)},e}(r.Component),w=n(165),S=n(107),I=n(702),O="chat_popup",P=function(t){function e(e){var n=t.call(this,e)||this;return n.populateRecentsContent=function(t){t&&(n.props.isChatRecentsPaneInitialized?Object(w.d)(t,n.props.isTeamsChatActivated):n.initializeRecents(t))},n.initializeRecents=function(t){n.props.isChatAPIInitialized?Object(w.a)(t,n.props.onRecentsReady,n.props.isTeamsChatActivated):(v=function(){window.removeEventListener(S.b.ChatAPIReady,v),Object(w.a)(t,n.props.onRecentsReady,n.props.isTeamsChatActivated)},window.addEventListener(S.b.ChatAPIReady,v))},n.onAnimationEnd=function(){n.chatPopUp&&n.chatPopUp.focus()},n.handleKeydown=function(t){switch(t.keyCode){case 27:t.stopPropagation(),t.preventDefault(),n.props.onDismiss(t),n.chatHeaderButton.focus()}},n.state={popupPosition:null},n}return Object(u.__extends)(e,t),e.prototype.calculatePopupPosition=function(){var t,e=parseInt(I.chatWindowWidth),n=this.chatHeaderButton&&this.chatHeaderButton.getBoundingClientRect();if(n&&0!==n.x||(this.chatHeaderButton=document.getElementById(l.a),n=this.chatHeaderButton&&this.chatHeaderButton.getBoundingClientRect()),n&&n.x>0){var i=n.left+.5*n.width-e/2;t=i+e>this.chatHeaderButton.offsetParent.clientWidth+this.chatHeaderButton.offsetWidth?{right:10}:i<0?{left:10}:{left:i}}else t=this.props.isRtl?{left:10}:{right:10};this.props.isThinHeader&&(t=Object(u.__assign)(Object(u.__assign)({},t),{top:this.props.isThinHeader?48:50})),this.setState({popupPosition:t})},e.prototype.render=function(){var t,e=Object(h.a)();return r.createElement(s.g,{onDismiss:this.props.onDismiss,ariaLabel:b.a.ChatOpened,role:"region",className:Object(s.t)(I.chatPopup,(t={},t[I.popupSlideIn]=this.props.isChatRecentsPaneOpen,t)),popupPosition:this.state.popupPosition,id:O,onAnimationEnd:this.onAnimationEnd,isVisible:this.props.isChatRecentsPaneOpen,isPersistant:!0},r.createElement("div",{"data-style":"o365shell",className:Object(s.t)(S.a.ChatRecents,I.recentsWrapper,e.neutral.lighterAlt.background),ref:this.populateRecentsContent,id:"chat_recent_pane"}))},e.prototype.componentDidUpdate=function(t){!t.isChatRecentsPaneOpen&&this.props.isChatRecentsPaneOpen&&(Object(p.f)().impression("ChatWindowOpened","Chat"),this.calculatePopupPosition())},e.prototype.componentDidMount=function(){window.addEventListener(s.d.RESIZE,this.props.onDismiss),window.addEventListener(s.d.SCROLL,this.props.onDismiss),this.chatPopUp||(this.chatPopUp=document.getElementById(O),this.chatPopUp.addEventListener(s.d.KEYDOWN,this.handleKeydown))},e.prototype.componentWillUnmount=function(){window.removeEventListener(s.d.RESIZE,this.props.onDismiss),window.removeEventListener(s.d.SCROLL,this.props.onDismiss),this.chatPopUp.removeEventListener(s.d.KEYDOWN,this.handleKeydown)},e}(r.Component),E=n(112),j=n(19);function _(t){return{type:j.i,isRecentsOpen:t}}function A(t){return{type:E.b,isRecentsInitialized:t}}var k=Object(a.b)((function(t){return{isChatAPIInitialized:t.chatState.isChatAPIInitialized,isChatRecentsPaneInitialized:t.chatState.isChatRecentsPaneInitialized,isChatRecentsPaneOpen:t.chatState.isChatRecentsPaneOpen,isThinHeader:Object(p.g)().isThinHeader,isTeamsChatActivated:t.chatState.isTeamsChatActivated,isRtl:t.userState&&t.userState.isRtl}}),(function(t){return{onRecentsReady:function(){t(A(!0))},onDismiss:function(e){var n=document.getElementById(l.a);e instanceof MouseEvent&&e.target&&n&&n.contains(e.target)||t(_(!1))}}}))(P),x=n(196),L=n(704);var T,D,R,z,B=function(){var t=Object(y.b)(Object(s.t)(S.a.ChatWrapper,L.wrapperStyle),"chat_wrapper_pane");return document.body.appendChild(t),t},U=function(){function t(){}return t.prototype.initialize=function(t){var e=this;return this.props=t,new Promise((function(t){T=function(){Object(p.f)().perfMarker("TeamsLoaderInitComplete"),Object(p.f)().perfMeasure("TeamsLoaderInitElapsed","TeamsLoaderInitStarted","TeamsLoaderInitComplete"),e.props.onTeamsChatActivated(!0),window.removeEventListener(x.b.TeamsChatAPIReady,T),t()},window.addEventListener(x.b.TeamsChatAPIReady,T),Object(p.f)().perfMarker("TeamsLoaderInitStarted"),e.appendTeamsChatDownloadScript()}))},t.prototype.create=function(){return Object(u.__awaiter)(this,void 0,void 0,(function(){var t=this;return Object(u.__generator)(this,(function(e){return[2,TeamsClient.SDK.create({chatsParentElement:B(),hostCtx:this.props.workloadId,loginHint:this.props.upn}).then((function(t){return TeamsClient.client=t,TeamsClient.client.notifications.get()})).then((function(e){return e.subscribe((function(e){e.type===x.a.UnreadCounterUpdate&&t.props.onUnreadConversationUpdate(e.data)}))}))]}))}))},t.prototype.appendTeamsChatDownloadScript=function(){var t=document.createElement("script");t.dataset.loginHint=this.props.upn;var e=null;window.URLSearchParams&&(e=new URLSearchParams(window.location.search)),t.src=e&&e.has("teams-embed-sdk-url")?e.get("teams-embed-sdk-url"):"https://teams.microsoft.com/embed-client/loader.js",document.body.appendChild(t)},t}(),H=n(103),M=document.getElementById(l.b),K=function(){function t(){var t=this;this.onPresenceStatusChanged=function(e){var n=t.props.presenceStatus,i=Object(H.b)(e,t.props.userPresenceStatusItems);Object(w.e)(i,(function(){Object(p.f)().exception("Chat_SetPresenceStatus_Failed",6,null),t.props.userPresenceStatusUpdate(n)}))},this.myPresenceStatusUpdate=function(e){if(t.props.userPresenceStatusItems){var n=Object(H.b)(e,t.props.userPresenceStatusItems);t.props.userPresenceStatusUpdate(n)}t.presenceStatusKey=e},this.onStartChat=function(){t.props.onRecentsOpen(!1,l.a),Object(p.f)().impression("ChatWindowOpened","Chat")}}return t.prototype.initialize=function(t){var e=this;return this.props=t,new Promise((function(t,n){D=function(){var t=e.getInitParams();window.removeEventListener(S.b.ChatCoreReady,D),swc.init(null,t).catch((function(t){window.removeEventListener(S.b.ChatAPIReady,R),n(t)}))},R=function(){t()},window.addEventListener(S.b.ChatCoreReady,D),window.addEventListener(S.b.ChatAPIReady,R),e.appendChatAPIDownloadScript()}))},t.prototype.create=function(){return Object(u.__awaiter)(this,void 0,void 0,(function(){var t=this;return Object(u.__generator)(this,(function(e){return window.removeEventListener(S.b.ChatAPIReady,R),this.registerSwcChatEvents(),[2,swc.create(S.c.Messaging,w.c,B()).then((function(){return swc.getPresence()})).then((function(e){return e.subscribeToMyStatus(t.myPresenceStatusUpdate),e.getStatusList()})).then((function(e){Object(H.c)(e)&&(t.props.onUserPresenceStatusListUpdate(e),t.presenceStatusKey?(t.myPresenceStatusUpdate(t.presenceStatusKey),t.presenceStatusKey=void 0):Object(p.f)().tag("Presence_API_getStatusList_Invalid",6))})).catch((function(t){Object(p.f)().exception("Presence_API_getStatusList_Failed",6,t)})).then((function(){return Object(u.__awaiter)(t,void 0,void 0,(function(){var t=this;return Object(u.__generator)(this,(function(e){switch(e.label){case 0:return swc.getKeyboard?[4,swc.getKeyboard().then((function(e){e.onKeyDown((function(e){"Escape"===e.key&&t.props.isChatRecentsPaneOpen&&t.dismissChatRecentsPane()}))})).catch((function(t){Object(p.f)().exception("get_keyboard_API_Failed",6,t)}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return Object(p.c)().subscribe("PresenceStatusChanged",this.onPresenceStatusChanged,!1),[2]}}))}))}))]}))}))},t.prototype.getInitParams=function(){return{toLoadUnreadConversationsCount:!0,locale:this.props.locale,correlationId:this.props.correlationId,loginHint:this.props.upn}},t.prototype.dismissChatRecentsPane=function(){this.props.onRecentsOpen(!1,l.a);var t=document.getElementById(l.a);t&&t.focus()},t.prototype.appendChatAPIDownloadScript=function(){var t=this;z=function(){t.onChatAPIDownloadScriptFailed()};var e=document.createElement("script");e.type="text/javascript",e.setAttribute("data-style","o365shell"),e.setAttribute("data-disable-autostart","true"),e.setAttribute("data-platform-id",this.props.workloadId),e.setAttribute("data-auth-type",this.props.isConsumerShell?"msa":"aad"),e.src=this.props.chatSDKUrl,e.onerror=z,document.head.appendChild(e)},t.prototype.onChatAPIDownloadScriptFailed=function(){Object(p.f)().exception("Chat API download script failed",6,null),this.props.onChatAPIInitialized(!1),this.props.responsiveEnabled||this.props.isConsumerShell&&(M.style.display="block")},t.prototype.registerSwcChatEvents=function(){swc.API.registerEvent(S.b.ApiUnreadConversationUpdate,this.props.onUnreadConversationUpdate),swc.API.registerEvent(S.b.ApiStartChat,this.onStartChat),swc.API.registerEvent(S.b.ApiOnCallStart,(function(){Object(p.f)().impression("CallStart","Chat")})),swc.API.registerEvent(S.b.ApiOnRecentItemSelected,(function(){Object(p.f)().click("ChatRecentItem","Chat")})),swc.API.registerEvent(S.b.ApiRecentsShown,this.startChatLoadingTime),swc.API.registerEvent(S.b.ApiRecentItemsLoaded,this.logChatLoadingTime)},t.prototype.startChatLoadingTime=function(){this.chatLoadingStartTime=Date.now()},t.prototype.logChatLoadingTime=function(){this.chatLoadingStartTime&&(Object(p.f)().timer("Chat_FirstTimeChatListShown",Date.now()-this.chatLoadingStartTime),swc.API.unregisterEvent(S.b.ApiRecentItemsLoaded,this.logChatLoadingTime),swc.API.unregisterEvent(S.b.ApiRecentsShown,this.startChatLoadingTime))},t}(),F=document.getElementById(l.b),N=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onChatClickHandler=function(t){var n=t instanceof MouseEvent;if(t instanceof KeyboardEvent)switch(t.which){case 40:n=t.altKey;break;case 13:case 32:t.preventDefault(),n=!0}n&&e.chatClicked(t)},e}return Object(u.__extends)(e,t),e.prototype.render=function(){return this.props.chatEnabled&&this.props.isChatAPIInitialized?r.createElement(k,null):null},e.prototype.componentDidMount=function(){e.chatLoading||!this.props.chatEnabled||this.props.isChatAPIInitialized||this.loadChatControl()},e.prototype.componentDidUpdate=function(){e.chatLoading||!this.props.chatEnabled||this.props.isChatAPIInitialized||this.loadChatControl()},e.prototype.loadChatControl=function(){var t=this;e.chatLoading=!0,Object(p.f)().perfMarker("ChatTimeToLoadStart"),this.chatControl=this.props.isConsumerShell?new K:new U,this.chatControl.initialize(this.props).then((function(){return t.chatControl.create()})).then((function(){return t.onChatControlCreated(!0)})).catch((function(e){return t.handleAPIInitializationError(e)})).then((function(){Object(p.f)().perfMarker("ChatTimeToLoadEnd"),Object(p.f)().perfMeasure("ChatTimeToLoad","ChatTimeToLoadStart","ChatTimeToLoadEnd"),Object(p.f)().impression("Chat_Button","Chat")}))},e.prototype.handleAPIInitializationError=function(t){Object(p.f)().exception("Chat_API_Initialization_Failed",6,t),e.chatLoading=!1,this.onChatControlCreated(!1)},e.prototype.onChatControlCreated=function(t){if(this.props.onChatAPIInitialized(t),t&&!this.props.responsiveEnabled){var n=document.getElementById(l.a);n&&(Object(s.I)(n,s.d.CLICK+" "+s.d.KEYDOWN,g),Object(s.p)(n,s.d.CLICK+" "+s.d.KEYDOWN,this.onChatClickHandler),F.style.display="block")}e.chatLoading=!1},e.prototype.chatClicked=function(t){t.preventDefault(),Object(p.f)().click("ChatButton","NavBar",null,null,"Chat recents list open "+!this.props.isChatRecentsPaneOpen),this.props.onRecentsOpen(!this.props.isChatRecentsPaneOpen,l.a)},e.chatLoading=!1,e}(r.Component),W=n(706),V=Object(a.b)((function(t){var e=t.shellInitDataState;return{disableToasts:e.renderSettings.disableToasts,locale:t.shellInitDataState.navBarData.CultureName,isConsumerShell:t.shellInitDataState.clientData.IsConsumerShell,correlationId:t.shellInitDataState.clientData.SHSID,responsiveEnabled:null!=t.shellInitDataState.layout,chatEnabled:t.chatState.chatEnabled,chatSDKUrl:t.chatState.webChatSDKUrl,isChatAPIInitialized:t.chatState.isChatAPIInitialized,isChatRecentsPaneOpen:t.chatState.isChatRecentsPaneOpen,isTeamsChatActivated:t.chatState.isTeamsChatActivated,workloadId:e.clientData.WorkloadId,presenceStatus:t.meControlState.userPresenceStatus,userPresenceStatusItems:t.meControlState.userPresenceStatusItems,upn:t.userState&&t.userState.upn}}),(function(t){return{onChatAPIInitialized:function(e){var n;t((n=e,{type:E.a,isChatAPIInitialized:n}))},onRecentsOpen:function(e,n){t(_(e)),t(Object(s.Q)(n))},onUnreadConversationUpdate:function(e){var n;Object(W.isNumber)(e)&&t((n=e,{type:E.d,unreadBadgeValue:n}))},userPresenceStatusUpdate:function(e){t(Object(c.h)(e))},onUserPresenceStatusListUpdate:function(e){t(Object(c.i)(e))},onTeamsChatActivated:function(e){t(function(t){return{type:E.c,isTeamsChatActivated:t}}(e))}}}))(N),Y=n(28),X=n(53),Z=n(60),Q=function(t){function e(e){var n=t.call(this,e)||this;return n.state={isHovered:!1},n}return Object(u.__extends)(e,t),e.prototype.componentDidMount=function(){this.props.isAvailable&&Object(p.f)().perfMarker("ChatTimeToInteractive")},e.prototype.getAriaLabel=function(){var t=b.a.Chat;return void 0!==this.props.unseenItemCount&&0!==this.props.unseenItemCount?Object(s.C)(b.a.ChatUnreadItems,""+this.props.unseenItemCount):t},e.prototype.render=function(){var t=this;if(!this.props.chatEnabled)return null;var e={controlID:this.props.id,isVisible:this.props.isAvailable,ariaLabel:this.getAriaLabel(),affordanceMenuItemText:b.a.Chat,iconID:this.props.isConsumerShell?"SkypeLogo":"OfficeChat",iconFontSize:y.f.toString(),isActive:this.props.isActive,isDarkModeEnabled:this.props.isDarkModeEnabled,onClick:this.props.onClick,onHoverStateChanged:function(e){t.setState({isHovered:e})},onDimensionsChanged:this.props.controlDimensionsChanged};return 0===this.props.renderContext?r.createElement(X.b,Object(u.__assign)({},e),r.createElement(s.n,{unseenItemCount:this.props.unseenItemCount,isParentHovered:this.state.isHovered,badgeStyles:m.headerButtonBadgePosition})):r.createElement(X.a,Object(u.__assign)({},e),r.createElement(s.n,{unseenItemCount:this.props.unseenItemCount,isParentHovered:this.state.isHovered,badgeStyles:Z.affordanceContextMenuItemBadgePosition}))},e}(r.Component);var J=Object(a.b)((function(t,e){var n,i=function(t){var e=!1,n=!1;t.chatState.chatEnabled&&null!==t.chatState.isChatAPIInitialized&&(t.chatState.isChatAPIInitialized?e=!0:t.userState.isConsumer&&(e=!0,n=!0));return{showButton:e,useButtonAsLink:n}}(t);return{isAvailable:i.showButton,id:e&&e.id,isActive:null!==(n=t.chatState&&t.chatState.isChatRecentsPaneOpen)&&void 0!==n&&n,useButtonAsLink:i.useButtonAsLink,chatWebLink:t.chatState&&t.chatState.chatWebLink,chatEnabled:t.chatState&&t.chatState.chatEnabled,isConsumerShell:t.shellInitDataState&&t.shellInitDataState.clientData.IsConsumerShell,controlDimensionsChanged:e.controlDimensionsChanged,isChatRecentsPaneInitialized:t.chatState.isChatRecentsPaneInitialized,unseenItemCount:t.chatState.unreadBadgeValue}}),(function(t){return{onClick:function(e,n){e.stopPropagation(),Object(p.f)().click("ChatButton","NavBar",null,null,"Active state: "+n.isActive+", Render context: "+n.renderContext+", Use Button as Link: "+n.useButtonAsLink),n.onClick&&n.onClick(e),n.useButtonAsLink?(e.preventDefault(),window.open(n.chatWebLink)):(n.isChatRecentsPaneInitialized||Object(w.b)((function(){t(A(!0))}),(function(e,n){t(_(e)),t(Object(s.Q)(n))})),t(_(!n.isActive)),t(Object(s.Q)(e.currentTarget&&e.currentTarget.id)))}}}),(function(t,e,n){var i=Object(u.__assign)(Object(u.__assign)({},n),t);return Object(u.__assign)(Object(u.__assign)(Object(u.__assign)({},i),e),{onClick:function(t){return e.onClick(t,i)},onDimensionsChanged:function(){return e.onDimensionsChanged(i)}})}))(Q),$=Object(a.b)((function(t){return{unreadBadgeValue:t.chatState.unreadBadgeValue,chatEnabled:t.chatState.chatEnabled,chatWebLink:t.chatState.chatWebLink,isConsumerShell:t.shellInitDataState&&t.shellInitDataState.clientData.IsConsumerShell}}))(C);function q(){var t=document.createElement("div");document.getElementById(Object(p.g)().top).appendChild(t);var e=Object(Y.a)();o.render(r.createElement(a.a,{store:e},r.createElement(V,null)),t)}}}]),HighResolutionTimingSupported&&(shellPerformance.mark("shell_chat_end"),shellPerformance.measure("shell_chat","shell_chat_start","shell_chat_end"));