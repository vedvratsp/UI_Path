(window.webpackJsonp_1e2cdec9_1360_4295_b73c_98d6f51866d5_0_1_0=window.webpackJsonp_1e2cdec9_1360_4295_b73c_98d6f51866d5_0_1_0||[]).push([[7],{qQzT:function(t,e,i){"use strict";i.r(e),i.d(e,"SiteScriptProgressCallbackType",function(){return n}),i.d(e,"SiteScriptRunAge",function(){return s}),i.d(e,"SiteScriptProgressStateManager",function(){return l});var n,s,r=i("17wl"),a=i("K9kD"),o=i("dq6a"),u=i("y88i"),g=function(t){function e(e){return t.call(this,{dataSourceName:"SiteScriptProgressDataSource"},{pageContext:e.pageContext})||this}return Object(r.__extends)(e,t),e.prototype.getDesignPackageMenuContents=function(){return this.getData(this._constructGetDesignPackageMenuContentsUrl.bind(this),function(t){return JSON.parse(t)},"GetDesignPackageMenuContentsAPI")},e.prototype.getSiteDesignTasks=function(){var t=this;return this.getData(this._constructGetSiteDesignTasksUrl.bind(this),function(t){return JSON.parse(t)},"GetSiteDesignTasksAPI",function(){return a.Killswitch.isActivated("C9983E3A-9ADE-46A3-AA71-5D790B7A6566","6/28/2019","GetSiteDesignTasksOnlyForCurrentWeb")?JSON.stringify({webUrl:""}):JSON.stringify({webUrl:u.UriEncoding.escapeUrlForCallback(t._pageContext.webAbsoluteUrl)})})},e.prototype.addSiteDesignTask=function(t){return this.getData(this._constructAddSiteDesignTaskUrl.bind(this),function(t){return JSON.parse(t)},"AddSiteDesignTaskAPI",function(){return JSON.stringify({siteDesignId:t})})},e.prototype.getSiteDesignRunStatus=function(t){return this.getData(this._constructGetSiteDesignRunStatusUrl.bind(this),function(t){return JSON.parse(t)},"GetSiteDesignRunStatusAPI",function(){return JSON.stringify({runId:t})})},e.prototype.getSiteDesignRuns=function(){return this.getData(this._constructGetSiteDesignRunsUrl.bind(this),function(t){return JSON.parse(t)},"GetSiteDesignStagesAPI")},e.prototype.getSiteDesignStages=function(t){return this.getData(this._constructGetSiteDesignStagesUrl.bind(this),function(t){return JSON.parse(t)},"GetSiteDesignStagesAPI",function(){return JSON.stringify({siteDesignId:t})})},e.prototype.applySiteDesign=function(t,e){var i=this;return this.getData(this._constructApplySiteDesignUrl.bind(this),function(t){return JSON.parse(t)},"ApplySiteDesignAPI",function(){return JSON.stringify({siteDesignId:t,webUrl:i._pageContext.webAbsoluteUrl,store:e})})},e.prototype.getTenantSiteDesigns=function(){return this.getData(this._consturctGetTenantSiteDesignsUrl.bind(this),function(t){return JSON.parse(t)},"GetTenantSiteDesignsAPI")},e.prototype.getOutOfBoxSiteDesigns=function(){return this.getData(this._consturctGetOutOfBoxSiteDesignsUrl.bind(this),function(t){return JSON.parse(t)},"GetOutOfBoxSiteDesignsAPI")},e.prototype.getIsSiteDesignPending=function(){return this.getData(this._constructValidateSiteDesignPendingUrl.bind(this),function(t){return JSON.parse(t)},"ValidateSiteDesignPendingAPI")},e.prototype.applyImplicitSiteDesign=function(){this.getData(this._constructApplyImplicitSiteDesignUrl.bind(this),function(t){return t},"ApplyImplicitSiteDesignAPI")},e.prototype._constructGetDesignPackageMenuContentsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetDesignPackageMenuContents")},e.prototype._constructGetSiteDesignTasksUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignTasks")},e.prototype._constructAddSiteDesignTaskUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.AddSiteDesignTaskToCurrentWeb")},e.prototype._constructGetSiteDesignRunStatusUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignRunStatusAndSchema")},e.prototype._constructGetSiteDesignRunsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignRun")},e.prototype._constructGetSiteDesignStagesUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesignStages")},e.prototype._constructApplySiteDesignUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.ApplySiteDesign")},e.prototype._consturctGetTenantSiteDesignsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesigns")},e.prototype._consturctGetOutOfBoxSiteDesignsUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.GetSiteDesigns?store=1")},e.prototype._constructValidateSiteDesignPendingUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.ValidatePendingWebTemplateExtension")},e.prototype._constructApplyImplicitSiteDesignUrl=function(){return this._constructGenericUrl("/_api/Microsoft.Sharepoint.Utilities.WebTemplateExtensions.SiteScriptUtility.ApplyImplicitSiteDesign")},e.prototype._constructGenericUrl=function(t){return new a.Uri(a.Uri.concatenate(u.UriEncoding.escapeUrlForCallback(this._pageContext.webServerRelativeUrl),t)).toString()},e}(o.b),c=function(){function t(t){this._dataSource=t.dataSource,this._currentCultureName=t.currentCultureName}return t.prototype.getSiteDesignRunStatus=function(t,e){var i=this;return this._dataSource.getSiteDesignRunStatus(t).then(function(t){var n=[],s=t&&t.d&&t.d.GetSiteDesignRunStatusAndSchema&&t.d.GetSiteDesignRunStatusAndSchema.ActionStatus&&t.d.GetSiteDesignRunStatusAndSchema.ActionStatus.results;if(s&&s.length)for(var r=0;r<s.length;r++){var a=s[r];n.push({outcomeCode:a.OutcomeCode,outcomeText:a.OutcomeText})}var o=void 0;return e&&t.d.GetSiteDesignRunStatusAndSchema.Schema&&(o=i._constructSiteScriptData(t.d.GetSiteDesignRunStatusAndSchema.Schema,void 0)),{siteScriptData:o,stageResultData:n}})},t.prototype.getSiteDesignRuns=function(){var t=this;return this._dataSource.getSiteDesignRuns().then(function(e){var i=[];if(e&&e.d&&e.d.results)for(var n=0;n<e.d.results.length;n++){var s=e.d.results[n],r=parseInt(s.StartTime,10);i.push({siteDesignId:s.SiteDesignID,siteDesignTitle:s.SiteDesignTitle,runId:s.ID,version:s.SiteDesignVersion,runDate:isNaN(r)?"":new Date(r).toLocaleDateString(t._currentCultureName)})}return i})},t.prototype.getSiteDesignStages=function(t){var e=this;return this._dataSource.getSiteDesignStages(t).then(function(i){if(i&&i.d&&i.d.GetSiteDesignStages)return e._constructSiteScriptData(i.d.GetSiteDesignStages,t)})},t.prototype.addSiteDesignTask=function(t){return this._dataSource.addSiteDesignTask(t).then(function(t){if(t&&t.d&&t.d.AddSiteDesignTaskToCurrentWeb&&t.d.AddSiteDesignTaskToCurrentWeb.ID)return{taskId:t.d.AddSiteDesignTaskToCurrentWeb.ID,siteDesignId:t.d.AddSiteDesignTaskToCurrentWeb.SiteDesignID,logonName:t.d.AddSiteDesignTaskToCurrentWeb.LogonName}})},t.prototype.getSiteDesignTasks=function(){return this._dataSource.getSiteDesignTasks().then(function(t){if(t&&t.d&&t.d.GetSiteDesignTasks&&t.d.GetSiteDesignTasks.results&&t.d.GetSiteDesignTasks.results.map)return t.d.GetSiteDesignTasks.results.map(function(t){return{taskId:t.ID,siteDesignId:t.SiteDesignID,logonName:t.LogonName}})})},t.prototype.applySiteDesign=function(t,e){return this._dataSource.applySiteDesign(t,e).then(function(t){if(t&&t.d&&t.d.ApplySiteDesign){var e=t.d.ApplySiteDesign.results;if(e){for(var i=[],n=0;n<e.length;n++){var s=e[n],r=parseInt(s.Outcome,10);i.push({outcomeCode:isNaN(r)?1:r,outcomeText:s.OutcomeText})}return i}}})},t.prototype.getTenantSiteDesigns=function(){var t=this;return this._dataSource.getTenantSiteDesigns().then(function(e){return t._getSiteDesignsFromServerData(e)})},t.prototype.getOutOfBoxSiteDesigns=function(){var t=this;return this._dataSource.getOutOfBoxSiteDesigns().then(function(e){return t._getSiteDesignsFromServerData(e)})},t.prototype.getIsSiteDesignPending=function(){return this._dataSource.getIsSiteDesignPending().then(function(t){return!(!t||!t.d||t.error||!t.d.ValidatePendingWebTemplateExtension)},function(t){return!1})},t.prototype.applyImplicitSiteDesign=function(){this._dataSource.applyImplicitSiteDesign()},t.prototype._constructSiteScriptData=function(t,e){var i=JSON.parse(t),n=[],s=[];if(i&&i.recipes.length)for(var r=0;r<i.recipes.length;r++)if(n.push({id:i.recipes[r].recipeGuid,name:i.recipes[r].recipeName,actions:i.recipes[r].actions}),i.recipes[r].actions&&i.recipes[r].actions.length)for(var a=0;a<i.recipes[r].actions.length;a++)i.recipes[r].actions[a]&&i.recipes[r].actions[a].stages&&i.recipes[r].actions[a].stages.length&&s.push.apply(s,i.recipes[r].actions[a].stages);return{siteDesignId:e,siteDesignTitle:i.siteDesignTitle,siteScripts:n,stageNames:s,isLongRunning:s.length>30}},t.prototype._getSiteDesignsFromServerData=function(t){if(t&&t.d&&t.d.GetSiteDesigns){var e=t.d.GetSiteDesigns.results;if(e&&e.length){for(var i=[],n=0;n<e.length;n++){var s=e[n];if(s){var r=s.SupportedWebTemplates&&s.SupportedWebTemplates.results&&s.SupportedWebTemplates.results.length?this._getSupportedTemplateTypes(s.SupportedWebTemplates.results):this._getSupportedTemplateTypes([s.WebTemplate]),a=s.TemplateFeatures&&s.TemplateFeatures.results;i.push({id:s.Id,title:s.Title,version:s.Version,schema:void 0,imageUrl:s.PreviewImageUrl,imageAltText:s.PreviewImageAltText,description:s.Description,supportedTemplates:r,designPackageId:void 0,thumbnailUrl:s.ThumbnailUrl,templateFeatures:a,isOutOfBoxTemplate:s.IsOutOfBoxTemplate,requiresGroupConnected:s.RequiresGroupConnected,requiresTeamsConnected:s.RequiresTeamsConnected,requiresYammerConnected:s.RequiresYammerConnected,isTenantAdminOnly:s.IsTenantAdminOnly})}}return i}}return[]},t.prototype._getSupportedTemplateTypes=function(t){var e=[];if(t)for(var i=0;i<t.length;i++){var n=t[i];if(n){var s=parseInt(n,10);isNaN(s)||e.push(s)}}return e},t}();!function(t){t[t.newProgressData=0]="newProgressData",t[t.newNonProgressData=1]="newNonProgressData",t[t.openPanelAction=2]="openPanelAction"}(n||(n={})),function(t){t[t.unknown=0]="unknown",t[t.old=1]="old",t[t.new=2]="new"}(s||(s={}));var p=function(){function t(t,e){this._totalTimeWaited=0,this._useTimerV2=!1,a.Killswitch.isActivated("67B7383B-D5DF-4CFD-9BCB-7D8A2A1468A1","05/30/2019","Delay site script exponential backoff")?(this._nextTimeout=t,this._lastTimeout=e):(this._useTimerV2=!0,this._nextTimeout=8,this._lastTimeout=8)}return t.prototype.getNextTimeout=function(){if(this._useTimerV2){var t=void 0;return this._totalTimeWaited>=120?(t=this._nextTimeout,this._nextTimeout=this._nextTimeout+this._lastTimeout,this._lastTimeout=t):t=8,this._totalTimeWaited+=t,1e3*t}var e=this._lastTimeout;return this._lastTimeout=this._nextTimeout,this._nextTimeout=this._nextTimeout+e,1e3*this._lastTimeout},t}(),S="00000000-0000-0000-0000-000000000000",D=S,l=function(){function t(t){var e=this;this._getSiteDesignProgress=function(t,i,r,a,o,u){if(!e.isRunComplete(i)){var g=setTimeout(e._getSiteDesignProgress.bind(e),a.getNextTimeout(),t,i,r,a,!1,u),c=!e._data[i].stageResultData||e._runCompletionStates[i].isSchemaDirty;e._provider.getSiteDesignRunStatus(t,c).then(function(t){if(t){var a=!1,o=!1;t.siteScriptData&&!t.siteScriptData.siteDesignTitle&&e._siteDesignRunDict[i]&&e._siteDesignRunDict[i].siteDesignTitle&&(t.siteScriptData.siteDesignTitle=e._siteDesignRunDict[i].siteDesignTitle);var c=e._getStageOutcomesKnownButIncomplete(t.stageResultData);t.siteScriptData&&(e._data[i].siteScriptData=t.siteScriptData,e._runCompletionStates[i].isSchemaDirty=!1,e._runCompletionStates[i].stagesRetrieved=!0,e._runCompletionStates[i].stagesRequired=t.siteScriptData.stageNames.length,a=!0),(!e._data[i].stageResultData||t.stageResultData.length>e._data[i].stageResultData.length||c<e._runCompletionStates[i].stageOutcomesKnownButIncomplete)&&(e._data[i].stageResultData=t.stageResultData,e._runCompletionStates[i].stageOutcomesKnown=t.stageResultData.length,e._runCompletionStates[i].stageOutcomesKnownButIncomplete=c,a=!0);var p=e.isRunComplete(i);e._runCompletionStates[i].age===s.unknown&&(e._runCompletionStates[i].age=p?s.old:s.new,a=!0),p&&(clearTimeout(g),e._runCompletionStates[i].age===s.new&&(e._state.hasARunCompleted=!0,o=!0)),a&&i===e._state.displayedRunKey?(e._updateState(e._runCompletionStates[i]),e._notifyListeners(n.newProgressData)):o&&e._notifyListeners(n.newProgressData)}else e._runCompletionStates[i].age===s.unknown&&(e._runCompletionStates[i].age=s.new,u&&e._getSiteDesignStages(i,r),i===e._state.displayedRunKey&&(e._updateState(e._runCompletionStates[i]),e._notifyListeners(n.newProgressData)))},function(t){e._runCompletionStates[i].age===s.unknown&&(e._runCompletionStates[i].age=s.new,u&&e._getSiteDesignStages(i,r),i===e._state.displayedRunKey&&(e._updateState(e._runCompletionStates[i]),e._notifyListeners(n.newProgressData))),404===t.status&&o&&e._provider.applyImplicitSiteDesign()})}},this._pageContext=t.pageContext,this._currentCultureName=this.getCurrentCultureName(),this._webTemplate=t.pageContext?t.pageContext.webTemplate:"",this._provider=new c({dataSource:this.createSiteScriptProgressDataSource(),currentCultureName:this._currentCultureName}),this._state={isSiteDesignPending:!1,stagesRetrieved:!1,stageOutcomesKnown:0,stageOutcomesKnownButIncomplete:0,displayedRunKey:D,stagesRequired:0,age:s.unknown,selectedTenantSiteDesign:"",hasARunCompleted:!1},this._runCompletionStates={},this._data={},this._registeredCallbacks=[],this._tenantSiteDesignsDict={},this._siteDesignRunDict={},this._siteDesignRunRequestSentDict={},this._tenantSiteDesignSchemaRequestSentDict={},this._triggeredOpenBefore=!1,t.pageContext?t.pageContext.hasPendingWebTemplateExtension?this._isSiteDesignPendingPromise=this._checkForPendingSiteDesign():this._isSiteDesignPendingPromise=Promise.resolve(!1):this._isSiteDesignPendingPromise=this._checkForPendingSiteDesign()}return t.getInstance=function(e){return t._instance||(t._instance=new t(e)),t._instance},t.prototype.createSiteScriptProgressDataSource=function(){return new g({pageContext:this._pageContext})},t.prototype.getCurrentCultureName=function(){return this._pageContext.currentCultureName},t.prototype.getWebTemplate=function(){return this._webTemplate},t.prototype.showSiteDesignRun=function(t){this._siteDesignRunDict[t]&&(this._data[t]||this._siteDesignRunRequestSentDict[t]||(this._siteDesignRunRequestSentDict[t]=!0,this._initializeRunData(t,s.unknown),this._getSiteDesignProgress(t,t,this._siteDesignRunDict[t].siteDesignId,new p(3,2),!1,!0)),this._updateState(Object(r.__assign)(Object(r.__assign)({},this._runCompletionStates[t]),{displayedRunKey:t,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0,showingTenantSiteDesigns:!1})),this._notifyListeners(n.newNonProgressData))},t.prototype.showTenantSiteDesigns=function(){this._updateState({showingTenantSiteDesigns:!0,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0}),this._notifyListeners(n.newNonProgressData)},t.prototype.hideTenantSiteDesigns=function(){this._state.showingTenantSiteDesigns&&(this._updateState({showingTenantSiteDesigns:!1,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0}),this._notifyListeners(n.newNonProgressData))},t.prototype.showTenantSiteDesign=function(t){var e=this;t?this._tenantSiteDesignsDict[t]&&(this._updateState({selectedTenantSiteDesign:t,selectedTenantSiteDesignSchema:this._tenantSiteDesignsDict[t].schema}),this._notifyListeners(n.newNonProgressData),this._tenantSiteDesignsDict[t].schema||this._tenantSiteDesignSchemaRequestSentDict[t]||(this._tenantSiteDesignSchemaRequestSentDict[t]=!0,this._provider.getSiteDesignStages(t).then(function(i){i&&(e._tenantSiteDesignsDict[t].schema=i),e._state.selectedTenantSiteDesign===t&&(e._state.selectedTenantSiteDesignSchema=e._tenantSiteDesignsDict[t].schema,e._notifyListeners(n.newNonProgressData))}))):(this._updateState({selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0}),this._notifyListeners(n.newNonProgressData))},t.prototype.applySiteDesign=function(t){var e;if(this._tenantSiteDesignsDict[t]){e=this._tenantSiteDesignsDict[t];var i=Date.now().toString();this._siteDesignRunRequestSentDict[i]=!0,this._siteDesignRunDict[i]={siteDesignTitle:e.title,siteDesignId:t,runId:i,version:e.version,runDate:(new Date).toLocaleDateString(this._currentCultureName)},this._state.siteDesignRuns=Object(r.__spreadArrays)([this._siteDesignRunDict[i]],this._state.siteDesignRuns),this._initializeRunData(i,s.new),this._data[i].stageResultData=[],this._addSiteDesignTask(e,i),this._updateState(Object(r.__assign)(Object(r.__assign)({},this._runCompletionStates[i]),{displayedRunKey:i,showingTenantSiteDesigns:!1,selectedTenantSiteDesign:"",selectedTenantSiteDesignSchema:void 0})),this._notifyListeners(n.newNonProgressData)}},t.prototype.retrieveTenantSiteDesignsAndSiteDesignRuns=function(){var t=this;this._requestedTenantSiteDesigns||(this._requestedTenantSiteDesigns=!0,this._provider.getTenantSiteDesigns().then(function(e){a.Engagement.logData({name:"SiteScripts.GetTenantSiteDesigns",extraData:{siteDesignCount:e?e.length:0}}),t._updateState({tenantSiteDesigns:e});for(var i=0;i<e.length;i++)t._tenantSiteDesignsDict[e[i].id]=e[i];t._notifyListeners(n.newNonProgressData)})),this._getSiteDesignRuns()},t.prototype.getSiteDesignRun=function(t){return this._siteDesignRunDict[t]},t.prototype._addSiteDesignTask=function(t,e){var i=this;this._data[e].siteScriptData=t.schema,this._runCompletionStates[e].stagesRetrieved=!0,this._runCompletionStates[e].stagesRequired=this._data[e].siteScriptData.stageNames.length,this._runCompletionStates[e].isSchemaDirty=!0,this._provider.addSiteDesignTask(t.id).then(function(n){i._getSiteDesignProgress(n.taskId,e,t.id,new p(3,2),!1,!1)})},t.prototype._getSiteDesignRuns=function(){var t=this;return this._siteDesignRunsPromise||(this._siteDesignRunsPromise=this._provider.getSiteDesignRuns().then(function(e){t._updateState({siteDesignRuns:e});for(var i=0;i<e.length;i++)t._siteDesignRunDict[e[i].runId]=e[i];return t._notifyListeners(n.newNonProgressData),e})),this._siteDesignRunsPromise},t.prototype._getSiteDesignTasks=function(){return this._siteDesignTasksPromise||(this._siteDesignTasksPromise=this._provider.getSiteDesignTasks()),this._siteDesignTasksPromise},t.prototype.getState=function(){return this._state},t.prototype.getData=function(t){return this._data[t]},t.prototype.getTenantSiteDesign=function(t){return this._tenantSiteDesignsDict[t]},t.prototype.registerCallback=function(t,e,i){this._registeredCallbacks[e]||(this._registeredCallbacks[e]={}),this._registeredCallbacks[e][t]=i},t.prototype.unregisterCallback=function(t,e){var i=this._registeredCallbacks[e];i&&i.hasOwnProperty(t)&&delete i[t]},t.prototype.triggerOpenPanelAction=function(){var t=this;this._triggeredOpenBefore||(this._triggeredOpenBefore=!0,this._isSiteDesignPendingPromise.then(function(e){e||t._getSiteDesignRuns().then(function(e){if(e&&e.length){var i=e[0].runId;t._initializeRunData(i,s.unknown),t._updateState(Object(r.__assign)(Object(r.__assign)({},t._runCompletionStates[i]),{displayedRunKey:i})),t._notifyListeners(n.newNonProgressData),t._siteDesignRunRequestSentDict[i]=!0,t._getSiteDesignProgress(i,i,e[0].siteDesignId,new p(3,2),!1,!0)}})})),this._notifyListeners(n.openPanelAction)},t.prototype.isRunComplete=function(t){if(this._runCompletionStates[t]){var e=this._runCompletionStates[t];return e.stagesRetrieved&&e.stageOutcomesKnown===e.stagesRequired&&0===e.stageOutcomesKnownButIncomplete}return!1},t.prototype.getCompletionRatio=function(t){return this._data&&this._data[t]&&this._data[t].siteScriptData&&this._data[t].siteScriptData.stageNames?0===this._data[t].siteScriptData.stageNames.length?1:Math.max(0,this._state.stageOutcomesKnown-this._state.stageOutcomesKnownButIncomplete)/this._data[t].siteScriptData.stageNames.length:0},t.prototype._updateState=function(t){this._state=Object(r.__assign)(Object(r.__assign)({},this._state),t)},t.prototype._initializeRunData=function(t,e){this._runCompletionStates[t]={stagesRetrieved:!1,stageOutcomesKnown:0,stageOutcomesKnownButIncomplete:0,stagesRequired:0,age:e},this._data[t]={siteScriptData:void 0,stageResultData:void 0}},t.prototype._notifyListeners=function(t){var e=this._registeredCallbacks[t];if(e)for(var i in e)if(e.hasOwnProperty(i))try{e[i](Object(r.__assign)({},this._state))}catch(t){}},t.prototype._checkForPendingSiteDesign=function(){var t=this;return this._siteDesignRunRequestSentDict[D]=!0,this._provider.getIsSiteDesignPending().then(function(e){return e?(a.Killswitch.isActivated("402D171D-93E7-49F4-8E32-4231EFA41B9D","5/10/2019","Show stages for long site designs")?t._initializeRunData(D,s.new):t._initializeRunData(D,s.unknown),t._updateState(Object(r.__assign)(Object(r.__assign)({},t._runCompletionStates[D]),{isSiteDesignPending:!0})),t._notifyListeners(n.newProgressData),a.Killswitch.isActivated("402D171D-93E7-49F4-8E32-4231EFA41B9D","5/10/2019","Show stages for long site designs")?t._getSiteDesignProgress(D,D,S,new p(3,2),!0,!1):t._getSiteDesignProgress(D,D,S,new p(3,2),!0,!0),!0):t._getSiteDesignTasks().then(function(e){return e.length?(t._initializeRunData(e[0].taskId,s.new),t._updateState(Object(r.__assign)(Object(r.__assign)({},t._runCompletionStates[e[0].taskId]),{displayedRunKey:e[0].taskId,isSiteDesignPending:!0})),t._notifyListeners(n.newProgressData),t._getSiteDesignProgress(e[0].taskId,e[0].taskId,e[0].siteDesignId,new p(3,2),!1,!0),!0):(t._updateState({canRenderWebTemplatesGalleryFirstRun:!0}),t._notifyListeners(n.newProgressData),!1)})},function(){return!1})},t.prototype._getSiteDesignStages=function(t,e){var i=this,s=this._provider.getSiteDesignStages(e);return s.then(function(e){i._data[t].siteScriptData||(i._data[t].siteScriptData=e,i._runCompletionStates[t].stagesRetrieved=!0,i._runCompletionStates[t].stagesRequired=e.stageNames.length,i._runCompletionStates[t].isSchemaDirty=!0,t===i._state.displayedRunKey&&(i._updateState(i._runCompletionStates[t]),i._notifyListeners(n.newNonProgressData)))}),s},t.prototype._getStageOutcomesKnownButIncomplete=function(t){for(var e=0,i=0;i<t.length;i++)4===t[i].outcomeCode&&(e+=1);return e},t}()}}]);